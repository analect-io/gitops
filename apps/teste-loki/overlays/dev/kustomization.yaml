apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: teste-loki
resources:
- ../../base
- auth-policy.yaml
- postgres-secrets-sealed.yaml
helmCharts:
- name: analect-app
  releaseName: analect-app
  version: 0.1.58
  repo: https://analect.github.io/helm-charts
  valuesInline:
    name: teste-loki
    envFrom:
    - secretRef:
        name: postgres-secrets
    image:
      repository: ghcr.io/analect/teste-loki
      tag: 08acc92e
    ResourceQuota:
      enabled: false
    migration:
      enabled: false
    autoscaling:
      enabled: true
      minReplicas: 1
      maxReplicas: 2
      targetCPUUtilizationPercentage: 80
    resources:
      requests:
        memory:
        cpu:
      limits:
        memory:
        cpu:
# - name: postgresql
#   releaseName: postgresql
#   version: 12.1.5
#   repo: https://charts.bitnami.com/bitnami
#   valuesInline:
#     commonAnnotations:
#       sidecar.istio.io/inject: "false"
#     commonLabels:
#       app: teste-loki
#       version: 15.1.0
#     global:
#       postgresql:
#         auth:
#           database: teste-loki
#           username: teste-loki
#           existingSecret: postgres-secrets
#           secretKeys:
#             adminPasswordKey: POSTGRES_PASSWORD
#             userPasswordKey: POSTGRES_PASSWORD
#     image:
#       debug: true
#     primary:
#       podAnnotations:
#         sidecar.istio.io/inject: "false"
#       resources:
#         limits:
#           cpu: 250m
#           memory: 2048Mi
#         requests:
#           cpu: 50m
#           memory: 512Mi