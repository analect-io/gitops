apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: teste-loki-auth-policy
  namespace: teste-loki
spec:
  selector:
    matchLabels:
      app: teste-loki
  action: ALLOW
  rules:
  - from:
    - source:
        namespaces: ["istio-system"]
    when:
    - key: request.headers[X-Envoy-External-Address]
      values:
      - "172.31.0.0/24" # Hosts Network
      - "10.233.0.0/16" # Pods Network
      - "34.205.60.141" # Istio GW
      - "94.62.74.120" # Diego

---
apiVersion: "authentication.istio.io/v1alpha1"
kind: Policy
metadata:
  name: teste-loki
  namespace: teste-loki
spec:
  peers:
  - mtls: {}

# ---
# apiVersion: "networking.istio.io/v1alpha3"
# kind: DestinationRule
# metadata:
#   name: teste-loki-dest
#   namespace: teste-loki
# spec:
#   host: "*.teste-loki.lgsk8sp1.grupologos.local"
#   trafficPolicy:
#     tls:
#       mode: ISTIO_MUTUAL