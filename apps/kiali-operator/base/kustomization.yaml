apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: kiali-operator
resources:
  - auth-policy.yaml
  - ns.yaml
helmCharts:
- name: kiali-operator
  includeCRDs: true
  releaseName: kiali-operator
  version: 1.63.2
  repo: https://kiali.org/helm-charts
  valuesInline:
    cr:
      create: true
      namespace: istio-system
      spec:
        istio_namespace: "istio-system"
        deployment:
          accessible_namespaces:
          - '**'
        external_services:
          prometheus:
            url: http://prometheus-server.monitoring
          grafana:
            auth:
              type: bearer
              token: secret:kiali-secrets:grafanaToken
            enabled: true
            in_cluster_url: http://grafana.monitoring
            url: https://grafana.diegoluisi.eti.br
          tracing:
            enabled: true
            in_cluster_url: 'http://tracing.istio-system/jaeger'
            use_grpc: false
            # Public facing URL of Jaeger
            url: 'https://jaeger.diegoluisi.eti.br/jaeger'
        auth:
          strategy: "openid"
          openid:
            client_id: "Iv1.e7a9a1f7587d4b79"
            password: secret:kiali-secrets:oidc-secret
            api_token: access_token
            issuer_uri: https://github.com/login/oauth/authorize
            username_claim: email
            authentication_timeout: 300
            # authorization_endpoint: https://github.com/login/oauth/authorize
            # token_endpoint: https://github.com/login/oauth/access_token
            disable_rbac: true
            insecure_skip_verify_tls: false
            scopes:
            - openid
            - profile
            - email
            additional_request_params:
              prompt: login
              redirect_uri: "https://kiali.diegoluisi.eti.br/svc/kiali"
              restartPolicy: Never
              server:
              web_port: 443
              web_root: /svc/kiali